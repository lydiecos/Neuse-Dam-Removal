---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Impacts of Dam Removal on the Neuse River"
subtitle: "https://github.com/lydiecos/Neuse-Dam-Removal"
author: "Lydie Costes"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage

```{r setup, include=FALSE}
# Get working directory
getwd()

# Load packages
library(tidyverse)
library(lubridate)
library(dataRetrieval)

# Set ggplot theme
theme_set(theme_bw())

# Possible sites:
# 01631000
# info: https://dwr.virginia.gov/fishing/fish-passage/#orange


# Load datasets
# Download list of available parameters
ShenaParams <- whatNWISdata(siteNumbers = "01631000")
# Download discharge data
ShenaFlow <- readNWISdv(siteNumbers = "01631000",
                    parameterCd = "00060",
                     startDate = "",
                     endDate = "")
# Most common parameters:
# 00060
# 00065
# 00095
# 00010
# 80154
# 80155
# 00191
# 00400
# 00900
# 00660
# 00671
# 00631
# 00618

# Download water quality data
ShenaWQ  <- readWQPqw(siteNumbers = "USGS-01631000",
                      parameterCd = c("00600", # nitrogen, unfiltered mg/L
                                      "00665", # phosphorus, unfiltered mg/L
                                      "00915", # calcium, filtered mg/L
                                      "00925", # magnesium, filtered mg/L
                                      "00930", # sodium,filtered mg/L
                                      "90095", # Specific conductance, uS/cm
                                      "31625", # Fecal coliform, CFU/100 mL
                                      "31673"), # Fecal streptocci, CFU/100 mL
                      startDate = "",
                      endDate = )

# consider also adding
# 00400: pH
# 00665: phosphorus
```


# Rationale and Research Questions

Over the past century, perceptions of dams have gradually changed, as understanding of their serious ecological issues has increased and as existing dams have aged, creating safety concerns and the need for expensive repairs. Dams block the passage of fish and other aquatic species, seriously disrupting life cycles for some species. They also impact water quality and alter natural flow. Increasingly, dam removal is pursued as an option to deal with aging dams and restore rivers. 

In this study, we seek to understand how dam removal has impacted the physical and chemical processes of one river, the Neuse River in North Carolina. Between 1998 and 2017, six dams were removed from the Neuse River (see map below). The gage we are using for these analyses is downstream from Goldsboro and should thus reflect some of the changes in flow and water quality that occurred after these removals.  

![map of Neuse River](../Figures-and-Maps/north-carolina-first-dam-removal-part-i.png)

We are interested in both changes in physical process and changes in chemical processes, which can vary widely according to the specific river, its history, and the dam removal process (Foley et al 2017). Dams allow for moderation of flow, often eliminating extreme flooding events. Therefore, dam removal in combination with increasing extreme weather events due to climate change could lead to more extreme and more frequent high flow events. On the other hand, natural river systems and riparian areas can be more resilient to flood events than artificially constructed channels, so true restoration could help mitigate high flow events to some extent. 

Changes in water quality are also an area of interest. Large amounts of sediment and minerals built up behind the dam may release quickly after removal, especially if the removal was sudden rather than gradual (Foley et al 2017). Over longer time, water quality is expected to improve because of restored ecological processes.

## Question 1: Have discharge levels become more extreme since dam removal?

## Question 2: Has there been an increase in release of sediment and nutrients over time? 
#+ Have levels steadily increased since dam removal, or did they spike and then stabilize?



\newpage

# Dataset Information

```{r wrangling}
# Change column names
names(NeuseFlow)[4:5] <- c("Discharge", "Approval.Code")
# Check dimensions
dim(NeuseFlow)
# Check Flow data formats
str(NeuseFlow)
# Check Flow data summary
summary(NeuseFlow)

# Convert WQ to wider dataframe with characteristics of interest
NeuseWQ_processed <- NeuseWQ %>%
  select(MonitoringLocationIdentifier, ActivityStartDate, HydrologicCondition, 
         CharacteristicName, ResultMeasureValue) %>%
  mutate(Variable = case_when(CharacteristicName == "Fecal Coliform" ~ "FecalColiform_cfu.100mL", 
                              CharacteristicName == "Fecal Streptococcus Group Bacteria" ~ "FecalStrep_cfu.100mL",
                              CharacteristicName == "Specific conductance" ~ "SpC_uS.cm",
                              CharacteristicName == "Calcium" ~ "Calcium_mg.L",
                              CharacteristicName == "Magnesium" ~ "Magnesium_mg.L",
                              CharacteristicName == "Sodium" ~ "Sodium_mg.L",
                              CharacteristicName == "Nitrogen, mixed forms (NH3), (NH4), organic, (NO2) and (NO3)" ~ "Nitrogen_mg.L",
                              CharacteristicName == "Phosphorus" ~ "Phosphorus_mg.L")) %>%
  select(-CharacteristicName) %>%
  pivot_wider(names_from = "Variable", values_from = "ResultMeasureValue")

# Rename the date column
names(NeuseWQ_processed)[2] <- "Date"
# Check WQ data summary
summary(NeuseWQ_processed)

# The two fecal variables have too many NAs; remove them
NeuseWQ_processed <- NeuseWQ_processed %>%
  select(-FecalStrep_cfu.100mL, -FecalColiform_cfu.100mL)

# Check dimensions
dim(NeuseWQ_processed)
# Check WQ data formats
str(NeuseWQ_processed)

```

\newpage

# Exploratory Analysis 

```{r}
# View flow over time
ggplot(NeuseFlow, aes(x = Date, y = Discharge)) +
  geom_line() 

# View Sodium over time
ggplot(NeuseWQ_processed, aes(x = Date, y = Sodium_mg.L)) +
  geom_point()
# View Calcium over time
ggplot(NeuseWQ_processed, aes(x = Date, y = Calcium_mg.L)) +
  geom_point()
# View Magnesium over time
ggplot(NeuseWQ_processed, aes(x = Date, y = Magnesium_mg.L)) +
  geom_point()
# View Nitrogen over time
ggplot(NeuseWQ_processed, aes(x = Date, y = Nitrogen_mg.L)) +
  geom_point()
# View Phosphorus over time
ggplot(NeuseWQ_processed, aes(x = Date, y = Phosphorus_mg.L)) +
  geom_point()
```


\newpage

# Analysis

```{r}

```



\newpage

# Summary and Conclusions


\newpage

# References

* Foley, M. M., J. R. Bellmore, J. E. O'Connor, J. J. Duda, A. E. East, G. E. Grant, C. W. Anderson, J. A. Bountry, M. J. Collins, P. J. Connolly, L. S. Craig, J. E. Evans, S. L. Greene,F. J. Magilligan, C. S. Magirl, J. J. Major, G. R. Pess,T. J. Randle, P. B. Shafroth, C. E. Torgersen, D. Tullos, A. C. Wilcox. 2017. Dam removal: Listening in. Water Resources Research. 53(7):5229-5246. https://doi-org.proxy.lib.duke.edu/10.1002/2017WR020457

